#!/usr/bin/env oksh

. /etc/pragnastic/pragnastic.conf
. /etc/pragnastic/pragnastic.subr

if [[ "$1" != "all" && "$1" != "backup" && "$1" != "data" ]]; then 
    echo "usage:  `basename $0` all|backup|data" >&2
    exit 1
fi

# Unmount data
if [[ "$1" == "data" || "$1" == "all" ]]; then
    zfs umount $data_shared_mountpoint && echo "$data_shared_mountpoint unmounted OK" || { echo "failed to unmount $data_shared_mountpoint, aborting"; exit 3; }
    zfs umount $data_mountpoint && echo "$data_mountpoint unmounted OK" || { echo "failed to unmount $data_mountpoint"; exit 3; }
fi

# Unmount backup
if [[ "$1" == "backup" || "$1" == "all" ]]; then
    zfs umount $backup0_mountpoint && echo "$backup0_mountpoint unmounted OK"
    zfs umount $backup1_mountpoint && echo "$backup1_mountpoint unmounted OK"
fi
